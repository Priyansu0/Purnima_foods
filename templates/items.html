{% extends "base.html" %}
{% block content %}
<div class="row">
  <h1>Items</h1>

  <form method="get" class="row">
    <input name="q" value="{{ q }}" placeholder="Search name / category / sku / barcode">
    <button class="btn ghost" type="submit">Search</button>
    <a class="btn ghost" href="{{ url_for('items_list') }}">Clear</a>
  </form>

  {% if current_user.role == "ADMIN" %}
    <a class="btn primary" href="{{ url_for('item_new') }}">+ New Item</a>
  {% endif %}
</div>

{% if current_user.role == "ADMIN" %}
<div class="row">
  <a class="btn ghost" href="{{ url_for('export_items_csv') }}">Export CSV</a>
  <form method="post" action="{{ url_for('import_items_csv') }}" enctype="multipart/form-data" class="row">
    <input type="file" name="file" accept=".csv" required>
    <button class="btn ghost" type="submit">Import CSV</button>
  </form>
</div>
{% endif %}

<div class="card">
  <table class="table">
    <thead>
      <tr>
        <th>ID</th><th>Name</th><th>Category</th><th>SKU</th><th>Barcode</th>
        <th class="right">Qty</th>
        <th class="right">Sell</th>
        <th class="right">LowThr</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr class="{% if it.quantity <= it.low_stock_threshold %}danger-row{% endif %}">
        <td>{{ it.id }}</td>
        <td><b>{{ it.name }}</b></td>
        <td>{{ it.category or "-" }}</td>
        <td>{{ it.sku or "-" }}</td>
        <td>{{ it.barcode or "-" }}</td>
        <td class="right">{{ it.quantity }}</td>
        <td class="right">{{ "%.2f"|format(it.sell_price) }}</td>
        <td class="right">{{ it.low_stock_threshold }}</td>
        <td class="right">
          {% if current_user.role == "ADMIN" %}
            <a class="btn ghost" href="{{ url_for('item_edit', item_id=it.id) }}">Edit</a>
            <form method="post" action="{{ url_for('item_delete', item_id=it.id) }}"
                  style="display:inline" onsubmit="return confirm('Delete item?')">
              <button class="btn danger" type="submit">Delete</button>
            </form>
          {% else %}
            <span class="muted">View</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
